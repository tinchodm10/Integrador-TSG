<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Batalla - Reinos del Oro</title>
  <link rel="stylesheet" href="../Styles/menu.css">
  <link rel="stylesheet" href="../Styles/boton-menu.css">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=UnifrakturCook:wght@700&display=swap" rel="stylesheet">
  <audio autoplay loop id="bgMusic">
    <source src="../Assets/Sonidos/Medieval%20Music%20%20Troubadour.mp3" type="audio/mpeg">
  </audio>
  <!-- Fanfarria opcional: si venimos de la selecciÃ³n, se reproducirÃ¡ al cargar -->
  <audio id="fanfare" preload="auto">
    <source src="../Assets/Sonidos/medieval-fanfare-6826.mp3" type="audio/mpeg">
  </audio>
</head>
<body class="tablero">
  <a href="boton-menu.html" class="btn-corona" title="MenÃº de Opciones">ðŸ‘‘</a>
  <header>
    <h1>Campo de Batalla</h1>
    <p>Reino elegido: <span id="reino-seleccionado">Valgor</span></p>
  </header>

  <main class="board">
    <section class="zona-enemiga">
      <div class="placeholder-carta">Carta Enemiga</div>
      <div class="placeholder-carta">Carta Enemiga</div>
      <div class="placeholder-carta">Carta Enemiga</div>
    </section>

    <section class="zona-propia">
      <div class="placeholder-carta">Tropa</div>
      <div class="placeholder-carta">Estructura</div>
      <div class="placeholder-carta">Hechizo</div>
    </section>

    <section class="mano-jugador">
      <div class="placeholder-carta mano">Carta 1</div>
      <div class="placeholder-carta mano">Carta 2</div>
      <div class="placeholder-carta mano">Carta 3</div>
      <div class="placeholder-carta mano">Carta 4</div>
    </section>
  </main>

  <footer>
    <a href="../index.html" class="btn-volver">â¬… Volver al inicio</a>
  </footer>
  <script>
    // Si la pÃ¡gina fue abierta tras elegir un mazo, reproducir la fanfarria
    (function() {
      try {
        const shouldPlay = sessionStorage.getItem('playFanfare');
        if (shouldPlay === '1') {
          sessionStorage.removeItem('playFanfare');
          const fanfare = document.getElementById('fanfare');
          const bg = document.getElementById('bgMusic');
          if (fanfare) {
            // Pausar bgMusic si estÃ¡ sonando
            try {
              if (bg && !bg.paused) {
                bg.pause();
              }
            } catch (e) {
              console.log('No se pudo pausar bgMusic:', e);
            }

            // Reproducir la fanfarria y al acabar reanudar bgMusic
            const p = fanfare.play();
            if (p !== undefined) {
              p.then(() => {
                fanfare.addEventListener('ended', function onEnd() {
                  fanfare.removeEventListener('ended', onEnd);
                  try {
                    if (bg) bg.play().catch(function(err){ console.log('No se pudo reanudar bgMusic:', err); });
                  } catch (e) {
                    console.log('Error al reanudar bgMusic:', e);
                  }
                });
              }).catch(function(err){
                console.log('No se pudo reproducir la fanfarria en table:', err);
                // Intentar reanudar bgMusic si falla
                try { if (bg) bg.play().catch(() => {}); } catch(e){}
              });
            } else {
              // Fallback: aÃ±adir listener ended por si se reproduce luego
              fanfare.addEventListener('ended', function onEnd() {
                fanfare.removeEventListener('ended', onEnd);
                try { if (bg) bg.play().catch(() => {}); } catch(e){}
              });
            }
          }
        }
      } catch (e) {
        console.log('Error comprobando playFanfare:', e);
      }
    })();
  </script>
</body>
</html>
